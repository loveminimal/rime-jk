--[[ 
keep_secondary_code_first: 保持五笔 86 的一级简码对应的汉字在候选列表首位
by Jack Liu <https://aituyaa.com>
--]]

local primary_code_table = {
    ["q"] = "都", ["w"] = "得", ["e"] = "也", ["r"] = "了", ["t"] = "我", ["y"] = "到", ["u"] = "的", ["i"] = "为", ["o"] = "是", ["p"] = "行",
        ["a"] = "来", ["s"] = "说", ["d"] = "中", ["f"] = "一", ["g"] = "就", ["h"] = "道", ["j"] = "人", ["k"] = "能", ["l"] = "而", 
            ["z"] = "可", ["x"] = "和", ["c"] = "不", ["v"] = "要", ["b"] = "如", ["n"] = "在", ["m"] = "大"
}

local secondary_code_table = {
    -- 第一行（G 开头）
    ["ga"] = "场", ["gb"] = "坛", ["gc"] = "声", ["gd"] = "歹", ["ge"] = "地", ["gf"] = "款", ["gg"] = "高", ["gh"] = "志", ["gi"] = "养", ["gj"] = "句", ["gk"] = "去", ["gl"] = "够", ["gm"] = "美", ["gn"] = "块", ["go"] = "亮", ["gp"] = "列", ["gq"] = "着", ["gr"] = "餐", ["gs"] = "士", ["gt"] = "土", ["gu"] = "差", ["gv"] = "死", ["gw"] = "韦", ["gx"] = "境", ["gy"] = "羊",
    -- 第二行（F 开头）
    ["fa"] = "与", ["fb"] = "互", ["fc"] = "辰", ["fd"] = "事", ["fe"] = "视", ["ff"] = "福", ["fg"] = "社", ["fh"] = "忘", ["fi"] = "一", ["fj"] = "骱", ["fk"] = "求", ["fl"] = "开", ["fm"] = "天", ["fn"] = "于", ["fo"] = "更", ["fp"] = "万", ["fq"] = "且", ["fr"] = "骰", ["fs"] = "示", ["ft"] = "祈", ["fu"] = "百", ["fv"] = "望", ["fw"] = "亡", ["fx"] = "鹘", ["fy"] = "下",
    -- 第三行（D 开头）
    ["da"] = "味", ["db"] = "史", ["dc"] = "虽", ["dd"] = "器", ["de"] = "吃", ["df"] = "号", ["dg"] = "吐", ["dh"] = "只", ["di"] = "叫", ["dj"] = "哈", ["dk"] = "口", ["dl"] = "里", ["dm"] = "民", ["dn"] = "吗", ["do"] = "员", ["dp"] = "兄", ["dq"] = "喂", ["dr"] = "嗯", ["ds"] = "别", ["dt"] = "啊", ["du"] = "无", ["dv"] = "喘", ["dw"] = "咋", ["dx"] = "唤", ["dy"] = "由",
    -- 第四行（S 开头）
    ["sa"] = "话", ["sb"] = "尝", ["sc"] = "谈", ["sd"] = "加", ["se"] = "许", ["sf"] = "证", ["sg"] = "各", ["sh"] = "办", ["si"] = "止", ["sj"] = "认", ["sk"] = "该", ["sl"] = "力", ["sm"] = "出", ["sn"] = "计", ["so"] = "训", ["sp"] = "试", ["sq"] = "讲", ["sr"] = "发", ["ss"] = "尚", ["st"] = "诉", ["su"] = "边", ["sv"] = "此", ["sw"] = "语", ["sx"] = "鸭", ["sy"] = "言",
    -- 第五行（A 开头）
    ["aa"] = "书", ["ab"] = "交", ["ac"] = "闽", ["ad"] = "丁", ["ae"] = "闲", ["af"] = "丰", ["ag"] = "鬼", ["ah"] = "敌", ["ai"] = "乙", ["aj"] = "闪", ["ak"] = "承", ["al"] = "六", ["am"] = "门", ["an"] = "缺", ["ao"] = "间", ["ap"] = "片", ["aq"] = "闻", ["ar"] = "疗", ["as"] = "舌", ["at"] = "帮", ["au"] = "那", ["av"] = "北", ["aw"] = "未", ["ax"] = "版", ["ay"] = "阌",
    -- 第六行（H 开头）
    ["ha"] = "情", ["hb"] = "八", ["hc"] = "怀", ["hd"] = "总", ["he"] = "条", ["hf"] = "夫", ["hg"] = "谷", ["hh"] = "卷", ["hi"] = "子", ["hj"] = "恰", ["hk"] = "公", ["hl"] = "并", ["hm"] = "送", ["hn"] = "快", ["ho"] = "首", ["hp"] = "分", ["hq"] = "单", ["hr"] = "曾", ["hs"] = "务", ["ht"] = "必", ["hu"] = "半", ["hv"] = "前", ["hw"] = "冬", ["hx"] = "心", ["hy"] = "处",
    -- 第七行（J 开头）
    ["ja"] = "们", ["jb"] = "会", ["jc"] = "做", ["jd"] = "斗", ["je"] = "他", ["jf"] = "使", ["jg"] = "个", ["jh"] = "份", ["ji"] = "位", ["jj"] = "从", ["jk"] = "付", ["jl"] = "仑", ["jm"] = "传", ["jn"] = "全", ["jo"] = "但", ["jp"] = "代", ["jq"] = "件", ["jr"] = "仅", ["js"] = "信", ["jt"] = "任", ["ju"] = "入", ["jv"] = "仍", ["jw"] = "作", ["jx"] = "你", ["jy"] = "倒",
    -- 第八行（K 开头）
    ["ka"] = "活", ["kb"] = "流", ["kc"] = "寸", ["kd"] = "台", ["ke"] = "杂", ["kf"] = "滑", ["kg"] = "法", ["kh"] = "亥", ["ki"] = "注", ["kj"] = "九", ["kk"] = "治", ["kl"] = "满", ["km"] = "母", ["kn"] = "汇", ["ko"] = "测", ["kp"] = "刻", ["kq"] = "泪", ["kr"] = "没", ["ks"] = "水", ["kt"] = "通", ["ku"] = "过", ["kv"] = "汽", ["kw"] = "学", ["kx"] = "派", ["ky"] = "酒",
    -- 第九行（L 开头）
    ["la"] = "世", ["lb"] = "耍", ["lc"] = "齿", ["ld"] = "名", ["le"] = "施", ["lf"] = "方", ["lg"] = "警", ["lh"] = "放", ["li"] = "药", ["lj"] = "花", ["lk"] = "落", ["ll"] = "多", ["lm"] = "英", ["ln"] = "廿", ["lo"] = "草", ["lp"] = "蓝", ["lq"] = "千", ["lr"] = "菲", ["ls"] = "生", ["lt"] = "萨", ["lu"] = "雅", ["lv"] = "散", ["lw"] = "带", ["lx"] = "夕", ["ly"] = "牙",
    -- 第十行（M 开头）
    ["ma"] = "专", ["mb"] = "巴", ["mc"] = "独", ["md"] = "启", ["me"] = "二", ["mf"] = "同", ["mg"] = "光", ["mh"] = "户", ["mi"] = "太", ["mj"] = "内", ["mk"] = "夺", ["ml"] = "两", ["mm"] = "央", ["mn"] = "码", ["mo"] = "犹", ["mp"] = "远", ["mq"] = "犬", ["mr"] = "破", ["ms"] = "石", ["mt"] = "所", ["mu"] = "达", ["mv"] = "肩", ["mw"] = "硕", ["mx"] = "确", ["my"] = "狐",
    -- 第十一行（T 开头）
    ["ta"] = "朱", ["tb"] = "雪", ["tc"] = "蛋", ["td"] = "袖", ["te"] = "欣", ["tf"] = "弗", ["tg"] = "革", ["th"] = "失", ["ti"] = "衣", ["tj"] = "斤", ["tk"] = "么", ["tl"] = "龙", ["tm"] = "向", ["tn"] = "随", ["to"] = "费", ["tp"] = "翻", ["tq"] = "裹", ["tr"] = "被", ["ts"] = "三", ["tt"] = "袭", ["tu"] = "近", ["tv"] = "雨", ["tw"] = "院", ["tx"] = "隐", ["ty"] = "用",
    -- 第十二行（R 开头）
    ["ra"] = "简", ["rb"] = "箫", ["rc"] = "固", ["rd"] = "回", ["re"] = "欢", ["rf"] = "非", ["rg"] = "等", ["rh"] = "悲", ["ri"] = "之", ["rj"] = "巾", ["rk"] = "对", ["rl"] = "簇", ["rm"] = "因", ["rn"] = "国", ["ro"] = "帽", ["rp"] = "皮", ["rq"] = "七", ["rr"] = "双", ["rs"] = "劝", ["rt"] = "第", ["ru"] = "竹", ["rv"] = "笔", ["rw"] = "瓦", ["rx"] = "鸡", ["ry"] = "又",
    -- 第十三行（E 开头）
    ["ea"] = "杨", ["eb"] = "柳", ["ec"] = "极", ["ed"] = "窝", ["ee"] = "林", ["ef"] = "本", ["eg"] = "干", ["eh"] = "平", ["ei"] = "根", ["ej"] = "见", ["ek"] = "每", ["el"] = "穿", ["em"] = "木", ["en"] = "午", ["eo"] = "机", ["ep"] = "楼", ["eq"] = "欠", ["er"] = "权", ["es"] = "格", ["et"] = "窗", ["eu"] = "空", ["ev"] = "年", ["ew"] = "须", ["ex"] = "穴", ["ey"] = "档",
    -- 第十四行（W 开头）
    ["wa"] = "乍", ["wb"] = "安", ["wc"] = "灾", ["wd"] = "况", ["we"] = "次", ["wf"] = "写", ["wg"] = "凉", ["wh"] = "怎", ["wi"] = "很", ["wj"] = "家", ["wk"] = "官", ["wl"] = "宽", ["wm"] = "头", ["wn"] = "德", ["wo"] = "审", ["wp"] = "免", ["wq"] = "寒", ["wr"] = "彻", ["ws"] = "客", ["wt"] = "定", ["wu"] = "五", ["wv"] = "它", ["ww"] = "实", ["wx"] = "象", ["wy"] = "页",
    -- 第十五行（Q 开头）
    ["qa"] = "睛", ["qb"] = "聊", ["qc"] = "臣", ["qd"] = "告", ["qe"] = "耳", ["qf"] = "考", ["qg"] = "特", ["qh"] = "思", ["qi"] = "眼", ["qj"] = "井", ["qk"] = "眸", ["ql"] = "老", ["qm"] = "目", ["qn"] = "牛", ["qo"] = "者", ["qp"] = "先", ["qq"] = "齐", ["qr"] = "取", ["qs"] = "食", ["qt"] = "田", ["qu"] = "进", ["qv"] = "遇", ["qw"] = "瞎", ["qx"] = "饭", ["qy"] = "卧",
    -- 第十六行（Y 开头）
    ["ya"] = "爪", ["yb"] = "当", ["yc"] = "车", ["yd"] = "点", ["ye"] = "采", ["yf"] = "上", ["yg"] = "瓜", ["yh"] = "致", ["yi"] = "至", ["yj"] = "轮", ["yk"] = "酸", ["yl"] = "罗", ["ym"] = "转", ["yn"] = "置", ["yo"] = "醒", ["yp"] = "轼", ["yq"] = "曲", ["yr"] = "轻", ["ys"] = "四", ["yt"] = "少", ["yu"] = "连", ["yv"] = "配", ["yw"] = "爱", ["yx"] = "小", ["yy"] = "酉",
    -- 第十七行（U 开头）
    ["ua"] = "打", ["ub"] = "白", ["uc"] = "据", ["ud"] = "售", ["ue"] = "集", ["uf"] = "段", ["ug"] = "工", ["uh"] = "攻", ["ui"] = "拉", ["uj"] = "拾", ["uk"] = "热", ["ul"] = "摸", ["um"] = "击", ["un"] = "皇", ["uo"] = "提", ["up"] = "找", ["uq"] = "看", ["ur"] = "排", ["us"] = "手", ["ut"] = "拥", ["uu"] = "推", ["uv"] = "指", ["uw"] = "项", ["ux"] = "换", ["uy"] = "掉",
    -- 第十八行（I 开头）
    ["ia"] = "盘", ["ib"] = "义", ["ic"] = "册", ["id"] = "部", ["ie"] = "新", ["if"] = "组", ["ig"] = "艮", ["ih"] = "收", ["ii"] = "良", ["ij"] = "给", ["ik"] = "永", ["il"] = "立", ["im"] = "商", ["in"] = "主", ["io"] = "舟", ["ip"] = "继", ["iq"] = "细", ["ir"] = "经", ["is"] = "络", ["it"] = "矛", ["iu"] = "维", ["iv"] = "予", ["iw"] = "预", ["ix"] = "颜", ["iy"] = "幺",
    -- 第十九行（O 开头）
    ["oa"] = "电", ["ob"] = "贝", ["oc"] = "川", ["od"] = "知", ["oe"] = "朵", ["of"] = "晨", ["og"] = "影", ["oh"] = "败", ["oi"] = "自", ["oj"] = "几", ["ok"] = "时", ["ol"] = "星", ["om"] = "映", ["on"] = "早", ["oo"] = "州", ["op"] = "则", ["oq"] = "最", ["or"] = "日", ["os"] = "矢", ["ot"] = "题", ["ou"] = "巡", ["ov"] = "明", ["ow"] = "顺", ["ox"] = "暗", ["oy"] = "尤",
    -- 第二十行（P 开头）
    ["pa"] = "精", ["pb"] = "数", ["pc"] = "长", ["pd"] = "刀", ["pe"] = "儿", ["pf"] = "师", ["pg"] = "戈", ["ph"] = "黑", ["pi"] = "弋", ["pj"] = "料", ["pk"] = "踏", ["pl"] = "戒", ["pm"] = "米", ["pn"] = "越", ["po"] = "踢", ["pp"] = "划", ["pq"] = "趣", ["pr"] = "紧", ["ps"] = "鼠", ["pt"] = "跃", ["pu"] = "足", ["pv"] = "起", ["pw"] = "逃", ["px"] = "糖", ["py"] = "赴",
    -- 第二十一行（N 开头）
    ["na"] = "成", ["nb"] = "区", ["nc"] = "环", ["nd"] = "右", ["ne"] = "现", ["nf"] = "感", ["ng"] = "存", ["nh"] = "黄", ["ni"] = "玉", ["nj"] = "验", ["nk"] = "雄", ["nl"] = "弄", ["nm"] = "马", ["nn"] = "巨", ["no"] = "朝", ["np"] = "班", ["nq"] = "真", ["nr"] = "友", ["ns"] = "十", ["nt"] = "才", ["nu"] = "左", ["nv"] = "有", ["nw"] = "王", ["nx"] = "辛", ["ny"] = "戚",
    -- 第二十二行（B 开头）
    ["ba"] = "妹", ["bb"] = "妇", ["bc"] = "姑", ["bd"] = "强", ["be"] = "她", ["bf"] = "姐", ["bg"] = "弓", ["bh"] = "好", ["bi"] = "娘", ["bj"] = "蠡", ["bk"] = "录", ["bl"] = "卵", ["bm"] = "面", ["bn"] = "女", ["bo"] = "贸", ["bp"] = "张", ["bq"] = "留", ["br"] = "努", ["bs"] = "动", ["bt"] = "群", ["bu"] = "建", ["bv"] = "奶", ["bw"] = "弱", ["bx"] = "弥", ["by"] = "云",
    -- 第二十三行（V 开头）
    ["va"] = "肠", ["vb"] = "匕", ["vc"] = "肢", ["vd"] = "肿", ["ve"] = "肝", ["vf"] = "票", ["vg"] = "脚", ["vh"] = "改", ["vi"] = "已", ["vj"] = "以", ["vk"] = "导", ["vl"] = "异", ["vm"] = "然", ["vn"] = "乃", ["vo"] = "疑", ["vp"] = "刘", ["vq"] = "气", ["vr"] = "股", ["vs"] = "山", ["vt"] = "胧", ["vu"] = "这", ["vv"] = "比", ["vw"] = "文", ["vx"] = "西", ["vy"] = "月",
    -- 第二十四行（C 开头）
    ["ca"] = "灯", ["cb"] = "层", ["cc"] = "虫", ["cd"] = "否", ["ce"] = "炊", ["cf"] = "飞", ["cg"] = "古", ["ch"] = "火", ["ci"] = "支", ["cj"] = "及", ["ck"] = "尿", ["cl"] = "展", ["cm"] = "炉", ["cn"] = "炮", ["co"] = "贵", ["cp"] = "克", ["cq"] = "眉", ["cr"] = "烟", ["cs"] = "尸", ["ct"] = "属", ["cu"] = "还", ["cv"] = "尾", ["cw"] = "炸", ["cx"] = "焰", ["cy"] = "业",
    -- 第二十五行（X 开头）
    ["xa"] = "剩", ["xb"] = "争", ["xc"] = "厂", ["xd"] = "种", ["xe"] = "床", ["xf"] = "后", ["xg"] = "广", ["xh"] = "意", ["xi"] = "久", ["xj"] = "科", ["xk"] = "应", ["xl"] = "鹿", ["xm"] = "色", ["xn"] = "鸟", ["xo"] = "负", ["xp"] = "利", ["xq"] = "稷", ["xr"] = "反", ["xs"] = "束", ["xt"] = "解", ["xu"] = "原", ["xv"] = "岛", ["xw"] = "稼", ["xx"] = "危", ["xy"] = "音"
}

-- 定义过滤器函数
function keep_secondary_code_first(input, env)
    -- 获取用户输入的编码
    local input_code = env.engine.context.input
    -- 仅处理单字符输入
    if #input_code == 2 then
        -- 从一级简码表中获取对应字符
        local secondary_char = secondary_code_table[input_code]
        if secondary_char then
            local new_candidates = {}
            local found = false
            local count = 0
            -- 遍历前 4 个候选项
            for cand in input:iter() do
                count = count + 1
                if cand.text == secondary_char then
                    -- 若找到一级简码字符，将其置于新候选列表首位
                    table.insert(new_candidates, 1, cand)
                    found = true
                else
                    -- 其他候选词依次添加到新候选列表
                    table.insert(new_candidates, cand)
                end
                if count >= 4 then
                    break
                end
            end
            -- 若找到一级简码字符，输出新候选列表
            if found then
                for _, cand in ipairs(new_candidates) do
                    yield(cand)
                end
                return
            end
        end
    end
    -- 若未找到一级简码字符或输入非单字符，输出原始候选列表
    for cand in input:iter() do
        yield(cand)
    end
end

-- 导出过滤器函数
return keep_secondary_code_first
